{"version":3,"sources":["../../source/repo/database.ts"],"names":["log","sqlite3","require","verbose","database","Database","initial","db","cb","run","connect","Promise","resolve","open","disconnect","close"],"mappings":"0RAEMA,CAAAA,GAAG,CAAG,mBAAM,mBAAN,C,CAENC,OAAO,CAAGC,OAAO,CAAC,SAAD,CAAP,CAAmBC,OAAnB,E,CAEhB,GAAIC,CAAAA,QAAa,CAAG,GAAIH,CAAAA,OAAO,CAACI,QAAZ,CAAqB,iBAArB,CAApB,C,KAEMC,CAAAA,OAAO,CAAG,CAACC,CAAD,CAAUC,CAAV,GAA2B,CACzCD,CAAE,CAACE,GAAH,CACG,0SADH,CADyC,CAIzCD,CAAE,EACH,C,CAEYE,OAAO,CAAG,SACd,GAAIC,CAAAA,OAAJ,CAAaC,CAAD,EACbR,QAAQ,CAACS,IADI,CAERD,CAAO,EAFC,KAIjB,wBAAY,IAAM,CACZR,QAAQ,CAACS,IADG,EAEdP,OAAO,CAACF,QAAD,CAAWQ,CAAX,CAEV,CAJD,CAIG,GAJH,CAJK,C,yBAYF,KAAME,CAAAA,UAAU,CAAG,SACjB,GAAIH,CAAAA,OAAJ,CAAaC,CAAD,EACZR,QAAQ,CAACS,IADG,KAIjBT,CAAAA,QAAQ,CAACW,KAAT,CAAe,IACNH,CAAO,EADhB,CAJiB,CAERA,CAAO,EAFX,CADF,C,2CAWQR,Q","sourcesContent":["import debug from 'debug'\r\nimport { setInterval } from 'core-js'\r\nconst log = debug('api:repo:database')\r\n\r\nconst sqlite3 = require('sqlite3').verbose()\r\n\r\nlet database: any = new sqlite3.Database('database.sqlite')\r\n\r\nconst initial = (db: any, cb: Function) => {\r\n  db.run(\r\n    `create table if not exists user (_id integer primary key autoincrement, type text default 'user', uuid text, name text, email text unique, password text, last_access datetime default current_timestamp, created_at datetime default current_timestamp, updated_at datetime default current_timestamp);`\r\n  )\r\n  cb()\r\n}\r\n\r\nexport const connect = async (): Promise<void> => {\r\n  return new Promise((resolve, reject) => {\r\n    if (database.open) {\r\n      return resolve()\r\n    }\r\n    setInterval(() => {\r\n      if (database.open) {\r\n        initial(database, resolve)\r\n      }\r\n    }, 250)\r\n  })\r\n}\r\n\r\nexport const disconnect = async (): Promise<void> => {\r\n  return new Promise((resolve, reject) => {\r\n    if (!database.open) {\r\n      return resolve()\r\n    }\r\n    database.close(() => {\r\n      return resolve()\r\n    })\r\n  })\r\n}\r\n\r\nexport default database\r\n"],"file":"database.js"}