{"version":3,"sources":["../../source/service/controller.ts"],"names":["log","Controller","constructor","auth","handler","req","res","next","token","get","uuid","check","set","handle","response","format","errors","status","send"],"mappings":"aAAA,oD,+RACA,KAAMA,CAAAA,GAAG,CAAG,mBAAM,wBAAN,CAAZ,CAqBO,KAAMC,CAAAA,UAAW,CAGtBC,WAAW,CAACC,CAAD,CAAcC,CAAd,CAAiC,0GAI5B,MAAOC,CAAP,CAAiBC,CAAjB,CAA2BC,CAA3B,GAA6D,MACrEC,CAAAA,CAAK,CAAGH,CAAG,CAACI,GAAJ,CAAQ,MAAR,CAD6D,CAErEC,CAAI,CAAG,KAAM,MAAKP,IAAL,CAAUQ,KAAV,CAAgBH,CAAhB,CAFwD,CAG3E,GAAIE,CAAI,SAAR,CACEJ,CAAG,CAACM,GAAJ,CAAQ,MAAR,CAAgBF,CAAhB,CADF,CAEE,KAAKN,OAAL,CAAaS,MAAb,CAAoBR,CAApB,CAAyBC,CAAzB,CAA8BC,CAA9B,CAFF,KAGO,MAGCO,CAAAA,CAAQ,CAAG,KAAM,MAAKV,OAAL,CAAaW,MAAb,CACrBV,CAAG,CAACI,GAAJ,CAAQ,UAAR,CADqB,CAErBJ,CAAG,CAACI,GAAJ,CAAQ,UAAR,CAFqB,IADP,CAAEO,MAAM,CAAE,CAAC,cAAD,CAAV,CACO,CAHlB,CASLV,CAAG,CAACW,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBJ,CAArB,CACD,CACF,CArB2C,EAC1C,KAAKX,IAAL,CAAYA,CAD8B,CAE1C,KAAKC,OAAL,CAAeA,CAChB,CANqB,C","sourcesContent":["import debug from 'debug'\r\nconst log = debug('api:service:controller')\r\n\r\nimport { IAuth } from './authorize'\r\n\r\nexport type Handle = {\r\n  (req: any, res: any, next: Function): Promise<void>\r\n}\r\n\r\nexport type ErrorHandle = {\r\n  (err: Error, req: any, res: any, next: Function): Promise<void>\r\n}\r\n\r\nexport type Format = {\r\n  (device: string, locate: string, success: boolean, payload: any): Promise<any>\r\n}\r\n\r\nexport interface IHandler {\r\n  handle: Handle\r\n  format: Format\r\n}\r\n\r\nexport class Controller {\r\n  public auth: IAuth\r\n  public handler: IHandler\r\n  constructor(auth: IAuth, handler: IHandler) {\r\n    this.auth = auth\r\n    this.handler = handler\r\n  }\r\n  public handle = async (req: any, res: any, next: Function): Promise<void> => {\r\n    const token = req.get('uuid')\r\n    const uuid = await this.auth.check(token)\r\n    if (uuid !== undefined) {\r\n      res.set('uuid', uuid)\r\n      this.handler.handle(req, res, next)\r\n    } else {\r\n      const success = false\r\n      const payload = { errors: ['Unauthorized'] }\r\n      const response = await this.handler.format(\r\n        req.get('X-Device'),\r\n        req.get('X-Locate'),\r\n        success,\r\n        payload\r\n      )\r\n      res.status(401).send(response)\r\n    }\r\n  }\r\n}\r\n"],"file":"controller.js"}