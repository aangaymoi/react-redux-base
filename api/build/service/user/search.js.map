{"version":3,"sources":["../../../source/service/user/search.ts"],"names":["log","Search","req","res","name","email","exact","order","offset","limit","query","errors","push","length","response","format","get","status","send","parseInt","users","userRepo","search","device","locate","success","payload","Promise","resolve","Controller","Admin"],"mappings":"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","sourcesContent":["import debug from 'debug'\r\nconst log = debug('api:service:user:search')\r\n\r\nimport { Admin } from '../authorize'\r\nimport { IHandler, Controller } from '../controller'\r\n\r\nimport userRepo, { User } from '../../repo/user'\r\n\r\nexport class Search implements IHandler {\r\n  public handle = async (req: any, res: any, next: Function): Promise<void> => {\r\n    let { name, email, exact, order, offset, limit } = req.query\r\n\r\n    const errors = []\r\n\r\n    if (!name && !email) {\r\n      errors.push(`\"name\" or \"email\" must be specified`)\r\n    }\r\n\r\n    if (name && email) {\r\n      errors.push(`only \"name\" or \"email\" can be specified`)\r\n    }\r\n\r\n    if (errors.length) {\r\n      const success = false\r\n      const payload = { errors }\r\n      const response = await this.format(\r\n        req.get('X-Device'),\r\n        req.get('X-Locate'),\r\n        success,\r\n        payload\r\n      )\r\n      return res.status(400).send(response)\r\n    }\r\n\r\n    exact = exact === 'true' ? true : false\r\n    order = order === 'asc' ? 'asc' : 'desc'\r\n    limit = parseInt(limit) >= 0 ? parseInt(limit) : 10\r\n    offset = parseInt(offset) >= 0 ? parseInt(offset) : 0\r\n\r\n    if (name) {\r\n      const users = await userRepo.search('name', name, {\r\n        exact,\r\n        order,\r\n        limit,\r\n        offset,\r\n      })\r\n\r\n      const success = true\r\n      const payload = { users }\r\n      const response = await this.format(\r\n        req.get('X-Device'),\r\n        req.get('X-Locate'),\r\n        success,\r\n        payload\r\n      )\r\n      return res.status(200).send(response)\r\n    }\r\n\r\n    if (email) {\r\n      const users = await userRepo.search('email', email, {\r\n        exact,\r\n        order,\r\n        limit,\r\n        offset,\r\n      })\r\n\r\n      const success = true\r\n      const payload = { users }\r\n      const response = await this.format(\r\n        req.get('X-Device'),\r\n        req.get('X-Locate'),\r\n        success,\r\n        payload\r\n      )\r\n      return res.status(200).send(response)\r\n    }\r\n  }\r\n\r\n  public format = (\r\n    device: string,\r\n    locate: string,\r\n    success: boolean,\r\n    payload: any\r\n  ): Promise<any> => {\r\n    switch (device) {\r\n      // case 'mobile':\r\n      // case 'tablet':\r\n      case 'desktop':\r\n      default:\r\n        switch (locate) {\r\n          case 'en-US':\r\n          default:\r\n            return Promise.resolve({\r\n              success,\r\n              payload,\r\n            })\r\n        }\r\n    }\r\n  }\r\n}\r\n\r\nconst search = new Controller(new Admin(), new Search())\r\n\r\nexport default search\r\n"],"file":"search.js"}