{"version":3,"sources":["../../../source/service/user/listing.ts"],"names":["log","Listing","req","res","field","order","offset","limit","query","errors","push","length","response","format","get","status","send","parseInt","users","userRepo","listing","device","locate","success","payload","Promise","resolve","Controller","Admin"],"mappings":"8eACA,KAAMA,CAAAA,GAAG,CAAG,mBAAM,0BAAN,CAAZ,CAOO,KAAMC,CAAAA,OAA4B,6CACvB,MAAOC,CAAP,CAAiBC,CAAjB,GAA6D,CAC3E,GAAI,CAAEC,KAAK,CAALA,CAAF,CAASC,KAAK,CAALA,CAAT,CAAgBC,MAAM,CAANA,CAAhB,CAAwBC,KAAK,CAALA,CAAxB,EAAkCL,CAAG,CAACM,KAA1C,CAEA,KAAMC,CAAAA,CAAM,CAAG,EAAf,CAMA,GAJKL,CAIL,EAHEK,CAAM,CAACC,IAAP,CAAa,2BAAb,CAGF,CAAID,CAAM,CAACE,MAAX,CAAmB,MAGXC,CAAAA,CAAQ,CAAG,KAAM,MAAKC,MAAL,CACrBX,CAAG,CAACY,GAAJ,CAAQ,UAAR,CADqB,CAErBZ,CAAG,CAACY,GAAJ,CAAQ,UAAR,CAFqB,IADP,CAAEL,MAAM,CAANA,CAAF,CACO,CAHN,CASjB,MAAON,CAAAA,CAAG,CAACY,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBJ,CAArB,CACR,CAEDP,CAAK,CAAa,KAAV,GAAAA,CAAK,CAAa,KAAb,CAAqB,MArByC,CAsB3EE,CAAK,CAAsB,CAAnB,EAAAU,QAAQ,CAACV,CAAD,CAAR,CAAuBU,QAAQ,CAACV,CAAD,CAA/B,CAAyC,EAtB0B,CAuB3ED,CAAM,CAAuB,CAApB,EAAAW,QAAQ,CAACX,CAAD,CAAR,CAAwBW,QAAQ,CAACX,CAAD,CAAhC,CAA2C,CAvBuB,MAwBrEY,CAAAA,CAAK,CAAG,KAAMC,eAASC,OAAT,CAAiBhB,CAAjB,CAAwB,CAC1CC,KAAK,CAALA,CAD0C,CAE1CE,KAAK,CAALA,CAF0C,CAG1CD,MAAM,CAANA,CAH0C,CAAxB,CAxBuD,CAgCrEM,CAAQ,CAAG,KAAM,MAAKC,MAAL,CACrBX,CAAG,CAACY,GAAJ,CAAQ,UAAR,CADqB,CAErBZ,CAAG,CAACY,GAAJ,CAAQ,UAAR,CAFqB,IADP,CAAEI,KAAK,CAALA,CAAF,CACO,CAhCoD,CAsC3E,MAAOf,CAAAA,CAAG,CAACY,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBJ,CAArB,CACR,CAxCsC,gCA0CvB,CACdS,CADc,CAEdC,CAFc,CAGdC,CAHc,CAIdC,CAJc,GAKG,CACjB,OAAQH,CAAR,EACE;AACA;AACA,IAAK,SAAL,CACA,QACE,OAAQC,CAAR,EACE,IAAK,OAAL,CACA,QACE,MAAOG,CAAAA,OAAO,CAACC,OAAR,CAAgB,CACrBH,OAAO,CAAPA,CADqB,CAErBC,OAAO,CAAPA,CAFqB,CAAhB,CAAP,CAHJ,CALJ,CAcD,CA9DsC,G,wBAiEzC,KAAMJ,CAAAA,OAAO,CAAG,GAAIO,uBAAJ,CAAe,GAAIC,iBAAJ,EAAf,CAA4B,GAAI3B,CAAAA,OAAJ,EAA5B,CAAhB,C,aAEemB,O","sourcesContent":["import debug from 'debug'\r\nconst log = debug('api:service:user:listing')\r\n\r\nimport { Admin } from '../authorize'\r\nimport { IHandler, Controller } from '../controller'\r\n\r\nimport userRepo, { User } from '../../repo/user'\r\n\r\nexport class Listing implements IHandler {\r\n  public handle = async (req: any, res: any, next: Function): Promise<void> => {\r\n    let { field, order, offset, limit } = req.query\r\n\r\n    const errors = []\r\n\r\n    if (!field) {\r\n      errors.push(`\"field\" must be specified`)\r\n    }\r\n\r\n    if (errors.length) {\r\n      const success = false\r\n      const payload = { errors }\r\n      const response = await this.format(\r\n        req.get('X-Device'),\r\n        req.get('X-Locate'),\r\n        success,\r\n        payload\r\n      )\r\n      return res.status(400).send(response)\r\n    }\r\n\r\n    order = order === 'asc' ? 'asc' : 'desc'\r\n    limit = parseInt(limit) >= 0 ? parseInt(limit) : 10\r\n    offset = parseInt(offset) >= 0 ? parseInt(offset) : 0\r\n    const users = await userRepo.listing(field, {\r\n      order,\r\n      limit,\r\n      offset,\r\n    })\r\n\r\n    const success = true\r\n    const payload = { users }\r\n    const response = await this.format(\r\n      req.get('X-Device'),\r\n      req.get('X-Locate'),\r\n      success,\r\n      payload\r\n    )\r\n    return res.status(200).send(response)\r\n  }\r\n\r\n  public format = (\r\n    device: string,\r\n    locate: string,\r\n    success: boolean,\r\n    payload: any\r\n  ): Promise<any> => {\r\n    switch (device) {\r\n      // case 'mobile':\r\n      // case 'tablet':\r\n      case 'desktop':\r\n      default:\r\n        switch (locate) {\r\n          case 'en-US':\r\n          default:\r\n            return Promise.resolve({\r\n              success,\r\n              payload,\r\n            })\r\n        }\r\n    }\r\n  }\r\n}\r\n\r\nconst listing = new Controller(new Admin(), new Listing())\r\n\r\nexport default listing\r\n"],"file":"listing.js"}