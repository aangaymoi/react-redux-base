{"version":3,"sources":["../../../source/service/user/signup.ts"],"names":["log","Signup","req","res","name","email","password","body","errors","push","length","response","format","get","status","send","user","userRepo","create","type","device","locate","success","payload","signup","Controller","None"],"mappings":"skBACA,KAAMA,CAAAA,GAAG,CAAG,mBAAM,yBAAN,CAAZ,CAUO,KAAMC,CAAAA,MAA2B,6CACtB,MAAOC,CAAP,CAAiBC,CAAjB,GAA6D,MACrE,CAAEC,IAAI,CAAJA,CAAF,CAAQC,KAAK,CAALA,CAAR,CAAeC,QAAQ,CAARA,CAAf,EAA4BJ,CAAG,CAACK,IADqC,CAGrEC,CAAM,CAAG,EAH4D,CAqB3E,GAhBKJ,CAgBL,EAfEI,CAAM,CAACC,IAAP,CAAa,mBAAb,CAeF,CAZKJ,CAYL,EAXEG,CAAM,CAACC,IAAP,CAAa,oBAAb,CAWF,CARIJ,CAAK,EAAI,CAAC,uBAAQA,CAAR,CAQd,EAPEG,CAAM,CAACC,IAAP,CAAa,sBAAb,CAOF,CAJKH,CAIL,EAHEE,CAAM,CAACC,IAAP,CAAa,uBAAb,CAGF,CAAID,CAAM,CAACE,MAAX,CAAmB,MAGXC,CAAAA,CAAQ,CAAG,KAAM,MAAKC,MAAL,CACrBV,CAAG,CAACW,GAAJ,CAAQ,UAAR,CADqB,CAErBX,CAAG,CAACW,GAAJ,CAAQ,UAAR,CAFqB,IADP,CAAEL,MAAM,CAANA,CAAF,CACO,CAHN,CASjB,MAAOL,CAAAA,CAAG,CAACW,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBJ,CAArB,CACR,CAED,KAAMK,CAAAA,CAAI,CAAG,KAAMC,eAASC,MAAT,CAAgB,CACjCC,IAAI,CAAE,MAD2B,CAEjCf,IAAI,CAAJA,CAFiC,CAGjCC,KAAK,CAALA,CAHiC,CAIjCC,QAAQ,CAAE,kBAAKA,CAAL,CAJuB,CAAhB,CAAnB,CAOA,GAAI,CAACU,CAAL,CAAW,MAGHL,CAAAA,CAAQ,CAAG,KAAM,MAAKC,MAAL,CACrBV,CAAG,CAACW,GAAJ,CAAQ,UAAR,CADqB,CAErBX,CAAG,CAACW,GAAJ,CAAQ,UAAR,CAFqB,IADP,CAAEL,MAAM,CAAE,CAAC,UAAD,CAAV,CACO,CAHd,CAST,MAAOL,CAAAA,CAAG,CAACW,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBJ,CAArB,CACR,CAlD0E,KAsDrEA,CAAAA,CAAQ,CAAG,KAAM,MAAKC,MAAL,CACrBV,CAAG,CAACW,GAAJ,CAAQ,UAAR,CADqB,CAErBX,CAAG,CAACW,GAAJ,CAAQ,UAAR,CAFqB,IADP,CAAEG,IAAI,CAAJA,CAAF,CACO,CAtDoD,CA4D3E,MAAOb,CAAAA,CAAG,CAACW,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBJ,CAArB,CACR,CA9DqC,gCAgEtB,MACdS,CADc,CAEdC,CAFc,CAGdC,CAHc,CAIdC,CAJc,GAKG,CACjB,OAAQH,CAAR,EACE;AACA;AACA,IAAK,SAAL,CACA,QACE,OAAQC,CAAR,EACE,IAAK,OAAL,CACA,QACE,MAAO,CACLC,OAAO,CAAPA,CADK,CAELC,OAAO,CAAPA,CAFK,CAAP,CAHJ,CALJ,CAcD,CApFqC,G,sBAuFxC,KAAMC,CAAAA,MAAM,CAAG,GAAIC,uBAAJ,CAAe,GAAIC,gBAAJ,EAAf,CAA2B,GAAIzB,CAAAA,MAAJ,EAA3B,CAAf,C,aAEeuB,M","sourcesContent":["import debug from 'debug'\r\nconst log = debug('api:service:user:signup')\r\n\r\nimport { None } from '../authorize'\r\nimport { IHandler, Controller } from '../controller'\r\n\r\nimport { isEmail } from 'validator'\r\n\r\nimport hash from '../../tool/hash'\r\nimport userRepo, { User } from '../../repo/user'\r\n\r\nexport class Signup implements IHandler {\r\n  public handle = async (req: any, res: any, next: Function): Promise<void> => {\r\n    const { name, email, password } = req.body\r\n\r\n    const errors = []\r\n\r\n    if (!name) {\r\n      errors.push(`\"name\" is missing`)\r\n    }\r\n\r\n    if (!email) {\r\n      errors.push(`\"email\" is missing`)\r\n    }\r\n\r\n    if (email && !isEmail(email)) {\r\n      errors.push(`\"email\" is not valid`)\r\n    }\r\n\r\n    if (!password) {\r\n      errors.push(`\"password\" is missing`)\r\n    }\r\n\r\n    if (errors.length) {\r\n      const success = false\r\n      const payload = { errors }\r\n      const response = await this.format(\r\n        req.get('X-Device'),\r\n        req.get('X-Locate'),\r\n        success,\r\n        payload\r\n      )\r\n      return res.status(400).send(response)\r\n    }\r\n\r\n    const user = await userRepo.create({\r\n      type: 'user',\r\n      name,\r\n      email,\r\n      password: hash(password),\r\n    } as User)\r\n\r\n    if (!user) {\r\n      const success = false\r\n      const payload = { errors: ['Conflict'] }\r\n      const response = await this.format(\r\n        req.get('X-Device'),\r\n        req.get('X-Locate'),\r\n        success,\r\n        payload\r\n      )\r\n      return res.status(409).send(response)\r\n    }\r\n\r\n    const success = true\r\n    const payload = { user }\r\n    const response = await this.format(\r\n      req.get('X-Device'),\r\n      req.get('X-Locate'),\r\n      success,\r\n      payload\r\n    )\r\n    return res.status(200).send(response)\r\n  }\r\n\r\n  public format = async (\r\n    device: string,\r\n    locate: string,\r\n    success: boolean,\r\n    payload: any\r\n  ): Promise<any> => {\r\n    switch (device) {\r\n      // case 'mobile':\r\n      // case 'tablet':\r\n      case 'desktop':\r\n      default:\r\n        switch (locate) {\r\n          case 'en-US':\r\n          default:\r\n            return {\r\n              success,\r\n              payload,\r\n            }\r\n        }\r\n    }\r\n  }\r\n}\r\n\r\nconst signup = new Controller(new None(), new Signup())\r\n\r\nexport default signup\r\n"],"file":"signup.js"}