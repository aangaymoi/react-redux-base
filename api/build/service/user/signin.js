"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Signin=void 0;var _debug=_interopRequireDefault(require("debug")),_authorize=require("../authorize"),_controller=require("../controller"),_validator=require("validator"),_hash=_interopRequireDefault(require("../../tool/hash")),_user=_interopRequireDefault(require("../../repo/user"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}const log=(0,_debug.default)("api:service:user:signin");class Signin{constructor(){_defineProperty(this,"handle",async(a,b)=>{const{email:c,password:d}=a.body,e=[];if(c||e.push(`"email" is missing`),c&&!(0,_validator.isEmail)(c)&&e.push(`"email" is not valid`),d||e.push(`"password" is missing`),e.length){const c=await this.format(a.get("X-Device"),a.get("X-Locate"),!1,{errors:e});return b.status(400).send(c)}const f=await _user.default.authen(c,(0,_hash.default)(d));if(!f){const c=await this.format(a.get("X-Device"),a.get("X-Locate"),!1,{errors:["Not Found"]});return b.status(404).send(c)}const g=await this.format(a.get("X-Device"),a.get("X-Locate"),!0,{user:f});return b.set("uuid",f.uuid).status(200).send(g)}),_defineProperty(this,"format",async(a,b,c,d)=>{switch(a){// case 'mobile':
// case 'tablet':
case"desktop":default:switch(b){case"en-US":default:return{success:c,payload:d};}}})}}exports.Signin=Signin;const signin=new _controller.Controller(new _authorize.None(),new Signin());var _default=signin;exports.default=_default;
//# sourceMappingURL=signin.js.map