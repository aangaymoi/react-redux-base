{"version":3,"sources":["../../../source/service/user/signin.ts"],"names":["log","Signin","req","res","email","password","body","errors","push","length","response","format","get","status","send","user","userRepo","authen","set","uuid","device","locate","success","payload","signin","Controller","None"],"mappings":"skBACA,KAAMA,CAAAA,GAAG,CAAG,mBAAM,yBAAN,CAAZ,CAUO,KAAMC,CAAAA,MAA2B,6CACtB,MAAOC,CAAP,CAAiBC,CAAjB,GAA6D,MACrE,CAAEC,KAAK,CAALA,CAAF,CAASC,QAAQ,CAARA,CAAT,EAAsBH,CAAG,CAACI,IAD2C,CAGrEC,CAAM,CAAG,EAH4D,CAiB3E,GAZKH,CAYL,EAXEG,CAAM,CAACC,IAAP,CAAa,oBAAb,CAWF,CARIJ,CAAK,EAAI,CAAC,uBAAQA,CAAR,CAQd,EAPEG,CAAM,CAACC,IAAP,CAAa,sBAAb,CAOF,CAJKH,CAIL,EAHEE,CAAM,CAACC,IAAP,CAAa,uBAAb,CAGF,CAAID,CAAM,CAACE,MAAX,CAAmB,MAGXC,CAAAA,CAAQ,CAAG,KAAM,MAAKC,MAAL,CACrBT,CAAG,CAACU,GAAJ,CAAQ,UAAR,CADqB,CAErBV,CAAG,CAACU,GAAJ,CAAQ,UAAR,CAFqB,IADP,CAAEL,MAAM,CAANA,CAAF,CACO,CAHN,CASjB,MAAOJ,CAAAA,CAAG,CAACU,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBJ,CAArB,CACR,CAED,KAAMK,CAAAA,CAAI,CAAG,KAAMC,eAASC,MAAT,CAAgBb,CAAhB,CAAuB,kBAAKC,CAAL,CAAvB,CAAnB,CAEA,GAAI,CAACU,CAAL,CAAW,MAGHL,CAAAA,CAAQ,CAAG,KAAM,MAAKC,MAAL,CACrBT,CAAG,CAACU,GAAJ,CAAQ,UAAR,CADqB,CAErBV,CAAG,CAACU,GAAJ,CAAQ,UAAR,CAFqB,IADP,CAAEL,MAAM,CAAE,CAAC,WAAD,CAAV,CACO,CAHd,CAST,MAAOJ,CAAAA,CAAG,CAACU,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBJ,CAArB,CACR,CAzC0E,KA6CrEA,CAAAA,CAAQ,CAAG,KAAM,MAAKC,MAAL,CACrBT,CAAG,CAACU,GAAJ,CAAQ,UAAR,CADqB,CAErBV,CAAG,CAACU,GAAJ,CAAQ,UAAR,CAFqB,IADP,CAAEG,IAAI,CAAJA,CAAF,CACO,CA7CoD,CAmD3E,MAAOZ,CAAAA,CAAG,CACPe,GADI,CACA,MADA,CACQH,CAAI,CAACI,IADb,EAEJN,MAFI,CAEG,GAFH,EAGJC,IAHI,CAGCJ,CAHD,CAIR,CAxDqC,gCA0DtB,MACdU,CADc,CAEdC,CAFc,CAGdC,CAHc,CAIdC,CAJc,GAKG,CACjB,OAAQH,CAAR,EACE;AACA;AACA,IAAK,SAAL,CACA,QACE,OAAQC,CAAR,EACE,IAAK,OAAL,CACA,QACE,MAAO,CACLC,OAAO,CAAPA,CADK,CAELC,OAAO,CAAPA,CAFK,CAAP,CAHJ,CALJ,CAcD,CA9EqC,G,sBAiFxC,KAAMC,CAAAA,MAAM,CAAG,GAAIC,uBAAJ,CAAe,GAAIC,gBAAJ,EAAf,CAA2B,GAAIzB,CAAAA,MAAJ,EAA3B,CAAf,C,aAEeuB,M","sourcesContent":["import debug from 'debug'\r\nconst log = debug('api:service:user:signin')\r\n\r\nimport { None } from '../authorize'\r\nimport { IHandler, Controller } from '../controller'\r\n\r\nimport { isEmail } from 'validator'\r\n\r\nimport hash from '../../tool/hash'\r\nimport userRepo, { User } from '../../repo/user'\r\n\r\nexport class Signin implements IHandler {\r\n  public handle = async (req: any, res: any, next: Function): Promise<void> => {\r\n    const { email, password } = req.body\r\n\r\n    const errors = []\r\n\r\n    if (!email) {\r\n      errors.push(`\"email\" is missing`)\r\n    }\r\n\r\n    if (email && !isEmail(email)) {\r\n      errors.push(`\"email\" is not valid`)\r\n    }\r\n\r\n    if (!password) {\r\n      errors.push(`\"password\" is missing`)\r\n    }\r\n\r\n    if (errors.length) {\r\n      const success = false\r\n      const payload = { errors }\r\n      const response = await this.format(\r\n        req.get('X-Device'),\r\n        req.get('X-Locate'),\r\n        success,\r\n        payload\r\n      )\r\n      return res.status(400).send(response)\r\n    }\r\n\r\n    const user = await userRepo.authen(email, hash(password))\r\n\r\n    if (!user) {\r\n      const success = false\r\n      const payload = { errors: ['Not Found'] }\r\n      const response = await this.format(\r\n        req.get('X-Device'),\r\n        req.get('X-Locate'),\r\n        success,\r\n        payload\r\n      )\r\n      return res.status(404).send(response)\r\n    }\r\n\r\n    const success = true\r\n    const payload = { user }\r\n    const response = await this.format(\r\n      req.get('X-Device'),\r\n      req.get('X-Locate'),\r\n      success,\r\n      payload\r\n    )\r\n    return res\r\n      .set('uuid', user.uuid)\r\n      .status(200)\r\n      .send(response)\r\n  }\r\n\r\n  public format = async (\r\n    device: string,\r\n    locate: string,\r\n    success: boolean,\r\n    payload: any\r\n  ): Promise<any> => {\r\n    switch (device) {\r\n      // case 'mobile':\r\n      // case 'tablet':\r\n      case 'desktop':\r\n      default:\r\n        switch (locate) {\r\n          case 'en-US':\r\n          default:\r\n            return {\r\n              success,\r\n              payload,\r\n            }\r\n        }\r\n    }\r\n  }\r\n}\r\n\r\nconst signin = new Controller(new None(), new Signin())\r\n\r\nexport default signin\r\n"],"file":"signin.js"}